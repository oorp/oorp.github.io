<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>5. Detailed Model Capture</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#detailed-model-capture">5. Detailed Model Capture</a>
<ul class="sectlevel2">
<li><a href="#forces-3">Forces</a></li>
<li><a href="#overview-3">Overview</a></li>
<li><a href="#what-next-10">What Next</a></li>
<li><a href="#tie-code-and-questions">5.1 Tie Code and Questions</a></li>
<li><a href="#refactor-to-understand">5.2 Refactor to Understand</a></li>
<li><a href="#step-through-the-execution">5.3 Step Through the Execution</a></li>
<li><a href="#look-for-the-contracts">5.4 Look for the Contracts</a></li>
<li><a href="#learn-from-the-past">5.5 Learn from the Past</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="detailed-model-capture"><a class="anchor" href="#detailed-model-capture"></a>5. Detailed Model Capture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The patterns in First Contact should have helped you to get acquainted with the software system, while those in Initial Understanding should have helped you to understand which are the most important entities in the system. Your main priority now is to build up a detailed model of those parts of the system that will be important for your reengineering effort.</p>
</div>
<div class="paragraph">
<p>Most of the patterns concerned with Detailed Model Capture entail considerably more technical knowledge, use of tools and investment of effort than the patterns we have applied up to now. This is only natural, since only after you have built up your Initial Understanding can you determine whether more intensive investment of effort will pay off.</p>
</div>
<div class="sect2">
<h3 id="forces-3"><a class="anchor" href="#forces-3"></a>Forces</h3>
<div class="paragraph">
<p>Although you already have an impression of the system, there are several forces at play that may make it difficult to extract a more detailed model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Details matter.</em> As argued by Brooks [Bro87], software engineering is different from other engineering disciplines because of the inherent lack of abstraction barriers. Other engineering disciplines rely on the laws of nature to hide irrelevant details, but software engineering must build on less solid foundations. <em>Consequently, it is essential to pay attention to the details.</em> The only question is how to filter out those details that do not matter, because you cannot possible investigate everything.</p>
</li>
<li>
<p>Design remains implicit._ As you read the code, many design decisions will become apparent to you, but it will not be clear why and how these decisions were made. In particular, it will be hard to tell which design decisions were easy to make, and which of them created a lot of grief. Nevertheless, such knowledge is crucial during a reengineering project because you want to avoid making the same mistakes over and over again. <em>Consequently, once you discover the underlying design rationale, make sure that it is properly recorded.</em> This way, your successors will be able to build on your discoveries rather than be forced to reinvent the wheel.</p>
</li>
<li>
<p><em>Design does evolve.</em> Change is an essential ingredient of a successful system, certainly in object-oriented development processes with their emphasis on iterative development. As a consequence, design documents will always be out-of date with respect to the actual situation. However, this also implies that change itself is the key to understand how and why the design of a system has evolved the way it is. <em>Consequently, assume that important design issues will be reflected in the source code and in the way this code has changed over time.* _Static structure versus Dynamic behavior.</em> Object-oriented source code tells you which classes are defined, and how they are arranged in a class hierarchy. It is much harder to see which objects are instantiated at run-time, and how they collaborate to support the system. On a fine-grained level however, the latter is much more relevant than the former, especially due to the use of polymorphism. _Consequently, to extract the detailed design one must inevitably study the dynamic behavior.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="overview-3"><a class="anchor" href="#overview-3"></a>Overview</h3>
<div class="paragraph">
<p>The patterns of Detailed Model Capture propose a series of activities that help you to expose design artifacts that are hidden in the code. Although some of these patterns, in particular Tie Code and Questions, are lightweight, most of them entail considerable effort, so you should evaluate carefully how much you expect to get out of applying them.</p>
</div>
<div class="paragraph">
<p>Figure 5.1 suggests some possible relationships between the patterns. Tie Code and Questions is perhaps the most fundamental of these patterns, and the easiest to apply. As you work through the source code, keep track of comments, questions, hypotheses and possible actions to perform by directly annotating the source code <em>at the point where the comment applies</em>. This pattern works well with the other patterns in this cluster, and can be productively applied throughout a reengineering project.</p>
</div>
<div class="paragraph">
<p>Refactor to Understand helps you to expose the design of cryptic code.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./media/image16.jpg" alt="image" width="432" height="360"></span></p>
</div>
<div class="paragraph">
<p>Figure 5.1: The patterns of Detailed Model Capture help you to expose the design of the software system and keep track of your understanding.</p>
</div>
<div class="paragraph">
<p>It is important to understand that the intent of this pattern is <em>not</em> to improve the code base itself, but only to improve your understanding. It might well be that you decide to keep the results of your refactorings, but this should not be your goal at this point. Your refactorings should instead be treated as experiments to tests various hypotheses concerning the code.</p>
</div>
<div class="paragraph">
<p>Since the source code gives you only a very static view of the class hierarchy, it is useful to Step Through the Execution to learn what objects are instantiated and run time and how they interact.</p>
</div>
<div class="paragraph">
<p>Although it is very easy to extract the interfaces of the classes in the system, this will not tell you very much about how these interfaces can or should be used. What you really need is to do is Look for the Contracts supported by each class. The contracts tell you which client-supplier relationships exist, and how the public interface of a class supports that relationship. Idiomatic coding practices and design patterns typically express such contracts in direct way, so you should train yourself to recognize them.</p>
</div>
<div class="paragraph">
<p>Finally, though you may be able to extract various design artifacts from the source code, you will not necessarily be able to get an insight into how the system evolved that way. In particular, you may wonder whether certain design decisions were really justified, or whether they were arbitrary, and you may wonder how stable parts of the design are. By comparing different versions of the code base and focusing on places where functionality was <em>removed</em> or refactored, you will be able to Learn from the Past.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-next-10"><a class="anchor" href="#what-next-10"></a>What Next</h3>
<div class="paragraph">
<p>Now that you have mastered the details of a part of your system, it is a good time to prepare for the actual reengineering by applying the patterns in Tests: Your Life Insurance!. In particular, as you Refactor to Understand, it is a good idea to Write Tests to Understand [p. 163], as this will give you confidence in your experiments. Also, patterns like Step Through the Execution, Look for the Contracts and Learn from the Past help you to see which components implement what functionality: this knowledge must be used to Test the Interface, Not the Implementation [p. 155] and to Record Business Rules as Tests [p. 159].</p>
</div>
</div>
<div class="sect2">
<h3 id="tie-code-and-questions"><a class="anchor" href="#tie-code-and-questions"></a>5.1 Tie Code and Questions</h3>
<div class="paragraph">
<p><strong>Intent</strong> <em>Keep the questions and answers concerning your reengineering activities synchronized with the code by storing them directly in the source files.</em></p>
</div>
<div class="sect3">
<h4 id="problem-8"><a class="anchor" href="#problem-8"></a>Problem</h4>
<div class="paragraph">
<p>How do you <em>keep track of your understanding</em> about a piece of code and the questions that you have, keep these <em>remarks synchronized with the code</em> during its future evolution, and <em>share them</em> with the other members of your team?</p>
</div>
<div class="paragraph">
<p><em>This problem is difficult because:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Writing up what you know and don’t know about the system you are analyzing is tedious and time-consuming.</p>
</li>
<li>
<p>Your understanding is a moving target, so it is hard to keep a written document up-to-date.</p>
</li>
<li>
<p>If you don’t write down your questions and insights as soon as they occur to you, you will not be able to keep track of them.</p>
</li>
<li>
<p>You want to share your knowledge with the team to maximize its value.</p>
</li>
<li>
<p>Logging questions and answers in log files, bulletin boards or email distribution lists may be convenient for disseminating knowledge within the team, and may provide a convenient searchable history of the team’s understanding, but when you are looking at a piece of code, it will be hard to tell what questions and answers pertain to it. _Yet, solving this problem is feasible because:* You can annotate the code, and therefore record your understanding physically close to the code element it refers to.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="solution-8"><a class="anchor" href="#solution-8"></a>Solution</h4>
<div class="paragraph">
<p>While you are working on the code annotate it directly and immediately with the questions you are facing.</p>
</div>
<div class="paragraph">
<p><em>In principle there are two ways to annotate the code.</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Comment-based Annotations.</em> This approach uses the commenting conventions of the programming language and as such is bettersuited for a text-oriented environment. A few conventions are needed to distinguish the normal comments from the annotations.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* #to: John #by: SD #on: 3/12/99
Screws up when we have nested IFs. */</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Basic tools part of your program environment can then be used to search and modify annotations. With a little bit of extra effort one can easily build tools to query, extract and cross-index all commentbased annotations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Method-based annotations.</em> This approach exploits the possibility to query which method invokes a given method, a feature provided by many of today’s programming environments. The idea is to declare a global method accepting a few strings as an argument and having an empty method body. Each time you want to annotate a particular piece of code, you invoke that method passing your annotations as a parameter.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="local-variable">this</span>.annotateCode(<span class="string"><span class="delimiter">&quot;</span><span class="content">#to: John #by: SD #on: 3/12/99</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Screws up when we have nested IFs.</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then use the querying and browsing facilities of your programming environment to identify the locations where this special method is invoked, thus where the annotations occur. Most programming environments can be extended by means of little scripts, in which case it is possible to develop tools to generate reports about all annotations.</p>
</div>
<div class="paragraph">
<p>Note that the less you change the code, the less likely it is that you will introduce errors. This makes the comment-based version safer than the method-based version.</p>
</div>
<div class="sect4">
<h5 id="hints-6"><a class="anchor" href="#hints-6"></a>Hints</h5>
<div class="ulist">
<ul>
<li>
<p>Record your annotations <em>as close as possible</em> to the code to which they refer.</p>
</li>
<li>
<p>Annotations may be <em>questions</em>, <em>hypotheses</em>, <em>“to do” lists</em>, or simply <em>observations</em> about the code that you wish to record for future reference.</p>
</li>
<li>
<p>Use conventions to <em>identify your annotations</em>. In a team context, include, for example, the initials of the developer that made the comments and the date the comment was entered. This way you can easily query them.</p>
</li>
<li>
<p><em>Follow the corporate practices.</em> If comments are written in a language other than English, continue if you can. However, if you have the choice never write your annotations in a language different from that in which the source code is written (English in most cases). Otherwise, you create a different context and force the reader to switch between them.</p>
</li>
<li>
<p>When you discover the <em>answer</em> to any one of your questions, <em>immediately update</em> the annotation for the benefit of future readers, or simply <em>delete</em> the question if it is no longer relevant.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tradeoffs-8"><a class="anchor" href="#tradeoffs-8"></a>Tradeoffs</h4>
<div class="sect4">
<h5 id="pros-8"><a class="anchor" href="#pros-8"></a>Pros</h5>
<div class="ulist">
<ul>
<li>
<p><em>Natural Synchronization.</em> You keep the code and the annotations in close physical proximity, and you thereby improve your chances of keeping them in sync. While modifying the code, you will more naturally modify the annotations, or remove them if they become obsolete.</p>
</li>
<li>
<p><em>Improves Team Communication.</em> Tie Code and Questions avoids that team members must open an extra communication channel (e-mail, bulletin boards, ···). They must read the code they work with anyhow so you can multiplex the code as a communication channel.</p>
</li>
<li>
<p><em>Minimize Context Description.</em> When you annotate the code you are immediately in context. This way you will minimize the need to describe the context of your questions and keep your effort low while documenting your questions and annotations.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cons-8"><a class="anchor" href="#cons-8"></a>Cons</h5>
<div class="ulist">
<ul>
<li>
<p><em>Passive in Nature.</em> Questions that you enter are not necessarily directed to anyone and even if they are, it is not certain that the addressee will read them or answer them in time. Additional tools are needed to collect the annotations and maybe even notify the appropriate persons.</p>
</li>
<li>
<p><em>Process Incompatibility.</em> Many companies are organized around a hierarchical reporting structure. Tie Code and Questions may be rejected by these organizations because it circumvents the normal communication channels. Also, some corporate practices impose strong constraints on what programmers are allowed to do with the code, which may limit the potential if this pattern. For instance, if annotations cannot be removed when they become obsolete, they will create too much noise to be useful.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="difficulties-8"><a class="anchor" href="#difficulties-8"></a>Difficulties</h5>
<div class="ulist">
<ul>
<li>
<p><em>Finding the Right Granularity.</em> As with any kind of comments, you should take care to introduce just the right amount of detail. Terse or cryptic annotations quickly lose their value, and verbose annotations will distract the reader from the code itself.</p>
</li>
<li>
<p><em>Motivating the Programmers to Write Comments.</em> Programmers generally do not like to write comments or documentation. One way of motivating them is to use the annotations during code reviews or status meetings: this way the comments have an immediate benefit.</p>
</li>
<li>
<p><em>Quality of the Answers.</em> As with any other kinds of documentation, it may happen that wrong answers are given. One way to deal with this situation is to review the annotations regularly within the team.</p>
</li>
<li>
<p><em>Eliminating the Annotations.</em> On certain occasions you may wish the remove the annotations. For instance, if you must deliver a “clean” version of the source-code to your customer, or if your compiler isn’t smart enough to remove an invocation of an empty method body. In that case, make sure that you have the proper tools to filter out the annotations.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rationale-7"><a class="anchor" href="#rationale-7"></a>Rationale</h4>
<div class="paragraph">
<p>This pattern has its roots in <em>literate programming</em> [RS89][Knu92]. A literate program reverses the usual relationship between program text and comments: executable code is embedded within documentation, not the other way around. Literate programming puts the emphasis on keeping the code and its documentation physically close. The physical proximity reduces the effort spent in keeping the code and its documentation in sync.</p>
</div>
</div>
<div class="sect3">
<h4 id="known-uses-8"><a class="anchor" href="#known-uses-8"></a>Known Uses</h4>
<div class="paragraph">
<p><em>Comment-based annotations.</em> Various programming environments provide implicit support for managing annotations within the code. Emacs, for example, has a built-in tool, called e-tags, which allows you to easily generate a cross-reference database of a a set of files [CRR96]. The Eiffel environment, on the other hand, allows you to assign different levels of visibility to your comments (and your code). If you assign private scope to your annotations you can easily separate the annotations yet make sure that these will not be seen externally.</p>
</div>
<div class="paragraph">
<p>The company MediaGeniX — a Belgian company operating in the multi-media sector — used a systematic code tagging mechanism to record information about changes. The programming environment was altered in such a way that every change to the code was automatically annotated with a tag that describes the motivation for the code change (bug fix, change request, new release), the name of developer, and the time of the modification. Only the last tag is kept in the code, but via the configuration management system it is possible to inspect previous tags and changes. The tag also includes a free field where the developers may write what they want and is often used for questions and answers.</p>
</div>
<div class="paragraph">
<p><em>Method-based annotations.</em> The Squeak development team [IKM<sup>+</sup>97] used this technique not so much to keep track of questions but as a means to facilitate communication in an open-source development project. In this team comments were introduced by invoking the method flag: defined in the class Object. Developers can query all senders of the flag: message to locate annotations. Furthermore, the method is defined to accept a symbol as its argument. This makes it possible to search more specifically, for example, for all the annotations flagged with the symbol #noteForJohn.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="smalltalk">Object&gt;&gt;flag: aSymbol

&quot;Send this message, with a relevant symbol as argument, to flag a message for subsequent retrieval. For example, you might put the following line in a number of messages:

self flag: #returnHereUrgently

Then, to retrieve all such messages, browse all senders of #returnHereUrgently.&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Figure 5.2 shows on the top pane all the senders of the flag: message in the Squeak2.7 environment. The bottom pane then shows the code of the method removeEmptyRows that contains a call to the method flag: highlighted. The flag: message is sent with argument #noteToJohn. The actual content of the annotation follows as a comment.</p>
</div>
</div>
<div class="sect3">
<h4 id="related-patterns-2"><a class="anchor" href="#related-patterns-2"></a>Related Patterns</h4>
<div class="paragraph">
<p>Tie Code and Questions works well in tandem with Refactor to Understand. Questions in the code may often be resolved by refactoring it. Conversely, as you Refactor to Understand, new questions will be raised and can be entered as annotations.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./media/image17.jpg" alt="image" width="424" height="273"></span></p>
</div>
<div class="paragraph">
<p>Figure 5.2: Finding all senders of a message in Squeak.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="refactor-to-understand"><a class="anchor" href="#refactor-to-understand"></a>5.2 Refactor to Understand</h3>
<div class="paragraph">
<p><strong>Intent</strong> _Iteratively refactor a part of a software system in order to validate and reflect your understanding of how it works.</p>
</div>
<div class="sect3">
<h4 id="problem-9"><a class="anchor" href="#problem-9"></a>Problem</h4>
<div class="paragraph">
<p>How can you understand a cryptic piece code?</p>
</div>
<div class="paragraph">
<p><em>This problem is difficult because:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cryptic code is difficult to read, hence to understand.</p>
</li>
<li>
<p>You may have some idea how the code works, but it is hard to verify because the code does not reflect your ideas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Yet, solving this problem is feasible because:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The piece of code is <em>relatively small</em> and has clearly defined boundaries.</p>
</li>
<li>
<p>Your development tools allow for <em>rapid edit-compile cycles</em>, so you can make some small changes and check whether you’re still able to compile the source-code or that your tests still run.</p>
</li>
<li>
<p>You have a <em>source-code browser</em> that allows you to query dependencies between source-code entities (<em>i.e.</em>, which methods invoke a given operation, which methods access a given attribute, &#8230;&#8203;), so that you can infer its purpose.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="solution-9"><a class="anchor" href="#solution-9"></a>Solution</h4>
<div class="paragraph">
<p>Iteratively rename and refactor the code to introduce meaningful names and to make sure the structure of the code reflects what the system is actually doing. Run regression tests after each change if they are available, else compile often to check whether your changes make sense. Decide what to do with the code after you have refactored it.</p>
</div>
<div class="sect4">
<h5 id="hints-7"><a class="anchor" href="#hints-7"></a>Hints</h5>
<div class="paragraph">
<p>Your primary goal here is to <em>understand the system</em>, not to improve the code. The changes you make to the code should therefore be treated as “experiments” to test your understanding of the code. As a consequence, you should <em>make a copy of the code</em> before you start. After you have refactored the code, it is possible that you release any of the changes you make, but you do not want to make that decision up front. Perhaps your refactoring experiments will actually improve the code, but it is just as likely that you will make a mess of things since you do not yet understand the code. It does not really matter at this stage. After a first experience you will be in a better position to do a proper job of refactoring.</p>
</div>
<div class="paragraph">
<p>It is hard to do a good job of refactoring without having tests in place to verify that your changes have not broken anything. If adequate tests do not exist, you should <em>not</em> seriously consider keeping the results of your refactoring experiments. However, consider applying Write Tests to Understand [p. 163] in tandem with Refactor to Understand.</p>
</div>
<div class="paragraph">
<p>You should select refactoring operations that will make design decisions more explicit in the code. The typical refactorings applied during this iterative restructuring are Rename Attribute [p. 292], Rename Method [p. 292], and Extract Method [p. 291].</p>
</div>
<div class="paragraph">
<p>The following guidelines will help you to find out where and how to apply these refactorings to improve the readability of the code. Many of these guidelines are considered to be just good, standard practice in Smalltalk programming [Bec97]. They apply, however, equally well to other programming languages. They can be applied in any order; each of them participates in the understanding of the others.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Rename attributes to convey roles.</em> Focus on attributes with cryptic names. To find out about their roles, look at all the attribute accesses (including invocations of accessors methods). Afterwards, rename the attribute and its accessors according to its role, update all references and re-compile the system.</p>
</li>
<li>
<p><em>Rename methods to convey intent.</em> To retrieve the intent of a method that does not have an intention revealing name, investigate all invocations and attribute uses, and deduce the method’s responsibility. Afterwards, rename the method according to its intent, update all invocations and re-compile the system.</p>
</li>
<li>
<p><em>Rename classes to convey purpose.</em> To capture the purpose of class having an unclear name, investigate clients of the class by examining who is invoking its operations or who is creating instances of it. Afterwards, rename the class according to its purpose, update all references and re-compile the system.</p>
</li>
<li>
<p><em>Remove duplicated code.</em> If you identify duplicated code, try to refactor it into a single location. As such, you will identify slight differences that you probably would not have noticed before refactoring and that are likely to reveal some subtle design issues.</p>
</li>
<li>
<p><em>Replace condition branches by methods.</em> If you encounter conditions with large branches, extract the leaves as new (private) methods. To name these methods, study the condition until you understand it well enough to choose an intention revealing name.</p>
</li>
<li>
<p><em>Refactor method bodies to a consistent level of abstraction.</em> Long method bodies with comments separating blocks of code violate the rule of the thumb that all statements in a single method body should have the same level of abstraction. Refactor such code by introducing a new (private) method for each separated block of code; name the method after the intent recorded in the comment.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tradeoffs-9"><a class="anchor" href="#tradeoffs-9"></a>Tradeoffs</h4>
<div class="sect4">
<h5 id="pros-9"><a class="anchor" href="#pros-9"></a>Pros</h5>
<div class="ulist">
<ul>
<li>
<p><em>Expose design.</em> Not only will the refactoring process improve your understanding of the code, but this understanding will also become explicit in the structure of the code. This will make it easier to further document that understanding by means of Tie Code and Questions or Write Tests to Understand [p. 163].</p>
</li>
<li>
<p><em>Incremental validation.</em> Normally, understanding does not arise as part of a single revelation, but as the result of an iterative process in which earlier understanding is the base for the next iteration. Refactor to Understand encourages such an approach, because of its emphasis on small steps and frequent verification (either by running tests or either by compiling often).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cons-9"><a class="anchor" href="#cons-9"></a>Cons</h5>
<div class="ulist">
<ul>
<li>
<p><em>Risk of introducing errors.</em> The less you change the code, the smaller your chances of introducing errors. Small refactorings should be behavior-preserving, but it may be non-trivial to verify that even simple refactorings do not break the code. If you do not have adequate regression tests in place, it can be risky to introduce changes, or costly to develop the needed tests. For these reasons it is important to attempt to Refactor to Understand only on a working copy of the software.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="difficulties-9"><a class="anchor" href="#difficulties-9"></a>Difficulties</h5>
<div class="ulist">
<ul>
<li>
<p><em>Tool Support.</em> Manually refactoring code can be tedious and risky [FBB<sup>+</sup>99]. Various tools, like the Refactoring Browser [RBJ97], greatly simplify the task of refactoring, and especially help to apply non-trivial refactorings such as Extract Method.</p>
</li>
<li>
<p><em>Acceptance of Changes.</em> Refactoring someone else’s code may prove a lot harder than refactoring your own. A lot of companies have a strong culture of code ownership, so improving someone else’s code is often considered an insult. That is one of the reasons why you should not necessarily release the refactored version to the rest of the team.</p>
</li>
<li>
<p><em>When to stop.</em> It is often difficult to stop changing code when you identify problems. Remember that your primary goal here is to just understand the system. When you have achieved that goal, it is time to stop.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="known-uses-9"><a class="anchor" href="#known-uses-9"></a>Known Uses</h4>
<div class="paragraph">
<p>Don Roberts and John Brant coined the term Refactor to Understand at ESUG ’97 and Smalltalk Solutions ’97 during a demonstration of the <em>Refactoring Browser</em>. They showed how they gradually understood an algorithm by renaming and refactoring its code. During the subsequent iterations of the pattern, the code slowly started to make sense and the design gradually became explicit in the code.</p>
</div>
<div class="paragraph">
<p>We applied this pattern ourselves during a FAMOOS case study. We had to understand a single method of about 3000 lines of C++, which was a deeply nested conditional. We first replaced the leaf condition branches by methods, gradually working our way up the nesting structure. After several iterations, we discovered that this method was actually implementing a complete parser for a small command language.</p>
</div>
<div class="paragraph">
<p>Harry Sneed reports several reengineering projects where a large Cobol program was refactored by removing all goto statements. However, he was later forced to reintroduce the go-to statements because the developers rejected his changes [Sne99].</p>
</div>
</div>
<div class="sect3">
<h4 id="related-patterns-3"><a class="anchor" href="#related-patterns-3"></a>Related Patterns</h4>
<div class="paragraph">
<p>“Arranging the Furniture” [Tay00] is a pattern to help newcomers feel at home when they start in a new project. The pattern solution is: “An adopter should be encouraged to ‘move in’ by cosmetically arranging the code.”</p>
</div>
</div>
<div class="sect3">
<h4 id="what-next-11"><a class="anchor" href="#what-next-11"></a>What Next</h4>
<div class="paragraph">
<p>Refactor to Understand works well in tandem with Tie Code and Questions. Refactorings are more expensive to implement than simply annotating the code, so first annotate, and then refactor. Also, consider to Write Tests to Understand [p. 163] as you refactor. These two activities reinforce each other since tests document your understanding of how a software artifact works, and refactoring helps you to expose its design. Furthermore, tests will help you to verify that your refactorings didn’t break anything.</p>
</div>
<div class="paragraph">
<p>When you have finished a round of Refactor to Understand, you must decide what to do with your changes. If you discard the experimental code, you should consider applying Tie Code and Questions to annotate the code base with the knowledge you have acquired.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-through-the-execution"><a class="anchor" href="#step-through-the-execution"></a>5.3 Step Through the Execution</h3>
<div class="paragraph">
<p><strong>Intent</strong> <em>Understand how objects in the system collaborate by stepping through examples in a debugger.</em></p>
</div>
<div class="sect3">
<h4 id="problem-10"><a class="anchor" href="#problem-10"></a>Problem</h4>
<div class="paragraph">
<p>How do you discover which objects are instantiated at run-time and how they collaborate?</p>
</div>
<div class="paragraph">
<p><em>This problem is difficult because:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The source code exposes the class hierarchy, not the objects instantiated at run time and how they interact.</p>
</li>
<li>
<p>Collaborations are typically spread out through the code. Although it is easy to see which classes and methods are defined in a system, it can be hard to tell by reading the source code alone which sequence of events will lead to an object being created or a method being invoked.</p>
</li>
<li>
<p>In the presence of polymorphism, it can be especially difficult to tell which objects are clients of which service providers. Just because an object uses a certain interface that another object provides, does not mean that the former is actually a client of the latter.</p>
</li>
<li>
<p>Reading the code will not tell you what concrete scenarios can take place. The actual flow of execution will depend on the internal state of all participating objects and this cannot be inferred directly from the source code.</p>
</li>
<li>
<p>The source code will not tell you which objects are long-lived and which are ephemeral (<em>i.e.</em>, local to the execution of a single method).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Yet, solving this problem is feasible because:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You are aware of some typical usage scenarios.</p>
</li>
<li>
<p>You can run the code inside a debugger.</p>
</li>
<li>
<p>Your attention is focussed on part of the system.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="solution-10"><a class="anchor" href="#solution-10"></a>Solution</h4>
<div class="paragraph">
<p>Run each of the scenarios and use your debugger to step through the code.</p>
</div>
<div class="paragraph">
<p>Observe which objects collaborate and how they are instantiated. Afterwards, generalize these observations and record your knowledge for future reference, possibly by means of Tie Code and Questions and Record Business Rules as Tests [p. 159].</p>
</div>
<div class="sect4">
<h5 id="hints-8"><a class="anchor" href="#hints-8"></a>Hints</h5>
<div class="paragraph">
<p>It is too time-consuming to step through every single statement of a running system. The assumption here is that you are focussed on some specific aspect of the system that is difficult to understand.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set <em>breakpoints</em> to interrupt execution when the system enters the code you are interested in.</p>
</li>
<li>
<p>Change the <em>internal state</em> of the objects to see how alternative execution paths are triggered.</p>
</li>
<li>
<p><em>Restart a method</em> currently on the execution stack to quickly verify a similar scenario.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tradeoffs-10"><a class="anchor" href="#tradeoffs-10"></a>Tradeoffs</h4>
<div class="sect4">
<h5 id="pros-10"><a class="anchor" href="#pros-10"></a>Pros</h5>
<div class="ulist">
<ul>
<li>
<p><em>Realistic View.</em> By stepping through the running program, you get a precise picture of how the scenario unfolds. Moreover, you can inspect the internal state of the objects involved, see how new objects are created and observe which objects collaborate under which circumstances.</p>
</li>
<li>
<p><em>Handles complexity.</em> On a small scale it is possible to infer object collaborations from analyzing the source code. Slicing tools for instance may tell you which statements of the source code are affected by a given variable. For large and complex systems however, the number of possibilities and interactions is just too large. Therefore, the only reasonable way to learn how objects collaborate is to study the execution traces.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cons-10"><a class="anchor" href="#cons-10"></a>Cons</h5>
<div class="ulist">
<ul>
<li>
<p><em>Scenario-based.</em> Your must restrict yourself to a limited set of scenarios, hence the observed object-collaborations are necessarily incomplete. Of course you must do your best to choose representative scenarios. Unfortunately, this choice brings you back to square one, because the only way to be sure that you have a representative set of scenarios is to verify whether they cover all possible objectcollaborations.</p>
</li>
<li>
<p><em>Restricted Applicability.</em> For systems where time plays a crucial role, stepping through the execution will give you an unrealistic view of the system’s behavior. Worse, for concurrent or distributed systems the mere fact of stepping through concurrent code may perturb the execution of the system itself. As such, you get the same effects as in Heisenberg’s uncertainty experiments, where determining exact positions of quantum particles imply that other attributes about these particles become uncertain.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="difficulties-10"><a class="anchor" href="#difficulties-10"></a>Difficulties</h5>
<div class="ulist">
<ul>
<li>
<p><em>Dependency on Tools.</em> You need to have good debugger to Step Through the Execution. Not only must it allow to set and remove breakpoints dynamically, it also should provide the means to examine the state of the objects involved. And to easily verify alternative paths, the debugger should allow you to change the internal state of an object, or even restart a method currently on the execution stack.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="what-next-12"><a class="anchor" href="#what-next-12"></a>What Next</h4>
<div class="paragraph">
<p>You will need concrete scenarios in order to Step Through the Execution (possibly inferred from Interview During Demo [p. 59]). Consider encoding these scenarios as test cases. You can then iteratively Write Tests to Understand [p. 163] as you Step Through the Execution since the insights you gain into the states of collaborating objects can then be formulated as concrete tests.</p>
</div>
<div class="paragraph">
<p>As you Step Through the Execution, it is a good idea to keep an eye on the way collaborating objects use each other’s interface. Afterwards, you can exploit the knowledge you have gained to Look for the Contracts.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="look-for-the-contracts"><a class="anchor" href="#look-for-the-contracts"></a>5.4 Look for the Contracts</h3>
<div class="paragraph">
<p><strong>Intent</strong> <em>Infer the proper use of a class interface by studying the way clients currently use it.</em></p>
</div>
<div class="sect3">
<h4 id="problem-11"><a class="anchor" href="#problem-11"></a>Problem</h4>
<div class="paragraph">
<p>How do you determine which contracts a class supports? That is, how do you know what a class expects from its client classes in order to function as intended.</p>
</div>
<div class="paragraph">
<p><em>This problem is difficult because:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client/supplier relationships and contracts are only implicit in the code. Although interfaces are easy to extract from the code, they do not necessarily tell you how to use them properly. If not explicitly documented, it can be hard to guess (a) the proper sequence in which methods should be invoked, (b) the valid parameters that should be supplied, (c) which methods should be invoked by which clients, (d) which methods should be overridden by subclasses.</p>
</li>
<li>
<p>Typing and scoping rules often force programmers to compromise the provider’s interface. Moreover, encapsulation constructs (<em>e.g.</em>, public/private declarations) are frequently misused to cope with implementation issues. For instance, database and user-interface toolkits often require the presence of public accessor methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Yet, solving this problem is feasible because:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have a <em>good understanding</em> of the system’s structure (for example obtained via Initial Understanding), so you can distinguish key classes from less important ones.</p>
</li>
<li>
<p>You trust that the class is being used properly by its clients and its subclasses.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="solution-11"><a class="anchor" href="#solution-11"></a>Solution</h4>
<div class="paragraph">
<p>Look for common programming idioms that expose the way clients make use of the class interface. Generalize your observations in the form of <em>contracts</em>, <em>i.e.</em>, explicit declarations of what a class expects from its clients.</p>
</div>
<div class="sect4">
<h5 id="hints-9"><a class="anchor" href="#hints-9"></a>Hints</h5>
<div class="paragraph">
<p>Your goal here is to understand how classes collaborate by exposing the way in which the interface to a class is used by its different clients. Since an exhaustive analysis of the code will probably exhaust you, you need some way to expose the contracts without stepping through every single line of code.</p>
</div>
<div class="paragraph">
<p>Although contracts are only implicit in the code, most frequently there will be hints in the code that a particular relationship exists between various classes. These hints may manifest themselves as idioms particular to the programming language in use, conventions in use by the development team, or even common design patterns.</p>
</div>
<div class="paragraph">
<p>What precisely you should look for will depend on the context, but here are a few examples that are generally useful:</p>
</div>
<div class="paragraph">
<p><em>Use Your Tools.</em> To get an overview of the relationships between classes, make the best use you can of the available tools. Although you could analyze the code by hand to infer relationships between classes, the process is tedious when applied to <em>more than a couple of classes</em>.</p>
</div>
<div class="paragraph">
<p>Many organizations use design extraction or round-trip engineering tools to document their systems. You can easily generate a draft view of the system you are analyzing without investing too much time. However, be prepared to be flooded with “boxes and arrows” diagrams containing irrelevant detail. Nevertheless, design extraction tools let you specify filters and ways to interpret code, so once your mappings are defined you can reuse them over multiple extractions.</p>
</div>
<div class="paragraph">
<p>The design overview can help you to identify key classes in the hierarchy (<em>i.e.</em>, abstract classes that many other classes inherit from), part-whole relationships, and so on.</p>
</div>
<div class="paragraph">
<p><em>Look for Key Methods.</em> Focus on the most important methods. With your knowledge of the system you will recognize key methods based on their signature.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Method Names.</em> Key methods are likely to bear intention revealing names [Bec97].</p>
</li>
<li>
<p><em>Parameter types.</em> Methods taking parameters with types corresponding to key classes in the system are likely to be important.</p>
</li>
<li>
<p><em>Recurring parameter types.</em> Parameters represent temporary associations between objects. When the same parameter types often recur in method signatures, they are likely to represent important associations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Look For Constructor Calls.</em> To understand how and when to instantiate objects of a particular class, look for methods in other classes invoking the constructors.</p>
</div>
<div class="paragraph">
<p>Pay particular attention to which parameters are passed to the constructor, and whether the parameters are shared or not. This will help you determine which instance variables are parts of the constructed object, and which are merely references to shared objects.</p>
</div>
<div class="paragraph">
<p>Invocations of constructor methods may reveal a <em>part-whole relationship</em>. When a client stores the result of a constructor method in an attribute then this client will probably serve as the whole. On the other hand, when a client passes itself as an argument to a constructor method it is likely to act as a part.</p>
</div>
<div class="paragraph">
<p>Invocations of a constructor method may also expose a Factory Method [p. 293] or even an Abstract Factory [p. 293]. If they do, then you know that you will be able extend the system by subclassing the class under study.</p>
</div>
<div class="paragraph">
<p><em>Look for Template/Hook Methods.</em> To understand how to specialize a class, look for (protected) methods that are overridden by subclasses, and identify the public methods that call them. The public, calling method is almost certainly a Template Method [p. 296]. Check the class hierarchy to determine whether the overridden method is <em>abstract</em>, in which case subclasses must implement it, or whether a default implementation is provided. In the latter case, it is a <em>hook method</em>, and subclasses may choose to override it or be happy with the default.</p>
</div>
<div class="paragraph">
<p>For each template method check all other methods it invokes as these are likely to represent other hook methods.</p>
</div>
<div class="paragraph">
<p><em>Look for Super Calls.</em> To understand what assumptions a class makes about its subclasses, look for super calls. Super calls may be used by subclasses to extend an inherited method in an <em>ad hoc</em> way. But very often super calls express the fact that a particular method <em>must not be overridden by subclasses</em> unless the overridden method is explicitly invoked by a super call.</p>
</div>
<div class="paragraph">
<p>This idiom is heavily used in Java by classes that define multiple constructors. Any subclass of java.lang.Exception, for example, is expected to define both a default constructor and a constructor that takes a String argument. Those constructors should do nothing in particular except invoke the super constructor so that the exception subclass will be correctly initialized.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tradeoffs-11"><a class="anchor" href="#tradeoffs-11"></a>Tradeoffs</h4>
<div class="paragraph">
<p><strong>Pros</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Reliable.</em> You can trust the source code more than the documentation.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="cons-11"><a class="anchor" href="#cons-11"></a>Cons</h5>
<div class="ulist">
<ul>
<li>
<p><em>Bad habits linger.</em> Just because certain practices appear in the code doesn’t mean that’s the right way to do things. The contracts that clients and subclasses adhere to are not necessarily the ones that the class actually supports.</p>
</li>
<li>
<p><em>Noise.</em> Browsing the source code is like mining — once in a while you will find a gem but you will have to dig through a lot of dirt first. By focusing your attention on idiomatic usages, you should be able to reduce the noise factor to a large degree.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="known-uses-10"><a class="anchor" href="#known-uses-10"></a>Known Uses</h4>
<div class="paragraph">
<p>Many researchers have investigated ways to analyze how clients use a class interface. For instance, Brown [Bro96], Florijn [FMvW97] and Wuyts [Wuy98] have all shown that it is possible to find symptoms of design patterns in code. Also, Schauer <em>et al.</em> [SRMK99] report about a technique to semi-automatically detect hook methods based on analysis of overridden methods. The latter technique scales quite well, due to their particular way of visualizing class hierarchies and emphasizing classes where many methods are overridden, hence are likely to define hook methods. Additionally, Steyaert <em>et al.</em> [SLMD96] have shown that it is possible to capture how subclasses depend on their superclasses (they have named these dependencies <em>reuse contracts</em>) and afterwards detect potential conflicts when the superclasses gets changed.</p>
</div>
</div>
<div class="sect3">
<h4 id="what-next-13"><a class="anchor" href="#what-next-13"></a>What Next</h4>
<div class="paragraph">
<p>One way to validate the contracts you have identified is to Step Through the Execution. Conversely, as you Step Through the Execution you will uncover collaborations between various objects. At that point you may Look for the Contracts that govern those collaborations.</p>
</div>
<div class="paragraph">
<p>If the code is hard to read, you may wish to Refactor to Understand before you Look for the Contracts. To understand how the contracts evolved to their current state, you might Learn from the Past.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="learn-from-the-past"><a class="anchor" href="#learn-from-the-past"></a>5.5 Learn from the Past</h3>
<div class="paragraph">
<p><strong>Intent</strong> <em>Obtain insights into the design by comparing subsequent versions of the system.</em></p>
</div>
<div class="sect3">
<h4 id="problem-12"><a class="anchor" href="#problem-12"></a>Problem</h4>
<div class="paragraph">
<p>How can you discover why the system is designed the way it is? How can you learn which parts of the system are stable and which parts aren’t?</p>
</div>
<div class="paragraph">
<p><em>This problem is difficult because:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The lessons learned during a development process are rarely recorded in documentation. Furthermore, the developers’ perceptions and memory of design decisions tend to warp over time. Therefore, you can only rely on source code and must reconstruct the learning process from there.</p>
</li>
<li>
<p>The system is large and has been released in successive versions, and therefore you have a large quantity of source code to analyze. Text comparison tools (such as Unix diff) will not scale up for the sizes you’re dealing with.</p>
</li>
<li>
<p>Even if you have a tool to identify the changes between two subsequent releases, most of the changes will concern adding <em>new</em> functionality. For the reconstruction of the learning process and how this consolidated into the class design, you’re main interest lies in what happened with the <em>old</em> functionality.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Yet, solving this problem is feasible because:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have a <em>good understanding</em> of the system’s structure (for example obtained via Initial Understanding), so you’re able to focus on appropriate subsystems.</p>
</li>
<li>
<p>You have access to the <em>subsequent releases</em> of the system, so you can reconstruct the changes by comparing the source code of the versions.</p>
</li>
<li>
<p>You have the means to examine what happened with individual source code entities. For instance, you have a <em>metrics tool</em> at your disposal, which allows you to quantify the size of entities in the sourcecode and use these numbers as a basis for comparison. As an alternative, you have a <em>configuration management</em> system that can provide you with information about particular changes to source-code entities.</p>
</li>
<li>
<p>You have enough <em>expertise with refactorings</em> in the implementation language being used, so you are able to recognize refactorings from their effects on source-code. Moreover, once you know which refactorings have been applied, you can use this expertise to make an educated guess at the underlying design rationale.</p>
</li>
<li>
<p>You have a <em>source-code browser</em> that allows you to query which methods invoke a given operation (even for polymorphic operations), so you can find out dependencies between classes and investigate how they are affected by the refactorings.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="solution-12"><a class="anchor" href="#solution-12"></a>Solution</h4>
<div class="paragraph">
<p>Use the metrics or configuration management tool to find entities where functionality has been <em>removed</em>, because such entities are a sign of a consolidating design. Also, look for entities which change often as these may point you to an unstable part of the design.</p>
</div>
<div class="sect4">
<h5 id="hints-10"><a class="anchor" href="#hints-10"></a>Hints</h5>
<div class="paragraph">
<p>Your goal is to get a feeling for how and why the system has evolved to its current state. In particular, you want to understand which parts of the system have been heavily refactored, which parts have become stable, and which parts are hot spots of activity.</p>
</div>
<div class="paragraph">
<p>Portions of the software system that have been heavily extended are simply a sign of growth, not of evolution of the design. On the other hand, portions where software has been <em>removed</em> are signs that the design of the system has been altered. By understanding how it has been altered, you can obtain insights into the stability of the design.</p>
</div>
<div class="paragraph">
<p><em>Unstable design.</em> If you detect repeated growth and refactoring in the same portion of the system, that should be a sign that the design is unstable. It may indicate opportunities to redesign that portion of the system to better accommodate the kinds of changes and extensions that habitually take place.</p>
</div>
<div class="paragraph">
<p><em>Mature and stable design.</em> A mature subsystem will exhibit some growth and refactoring, followed by a period of stability. Early versions of the subsystem will show growth followed by refactoring, followed by a period in which only new classes and subclasses are added. As the hierarchy stabilizes, classes near the top of the hierarchy will exhibit only moderate growth, but little refactoring.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tradeoffs-12"><a class="anchor" href="#tradeoffs-12"></a>Tradeoffs</h4>
<div class="sect4">
<h5 id="pros-11"><a class="anchor" href="#pros-11"></a>Pros</h5>
<div class="ulist">
<ul>
<li>
<p><em>Concentrates on important design artifacts,</em> because the changes point you to those places where the design is expanding or consolidating and this in turn provides insight into the underlying design rationale.</p>
</li>
<li>
<p><em>Provides an unbiased view of the system,</em> because you do not have to formulate assumptions about what to expect in the software (in contrast to top-down techniques like Speculate about Design [p. 87]).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cons-12"><a class="anchor" href="#cons-12"></a>Cons</h5>
<div class="ulist">
<ul>
<li>
<p><em>Requires considerable experience,</em> in the sense that the reverse engineer must be well aware of how the refactorings interact with the coding idioms in the particular implementation language.</p>
</li>
<li>
<p><em>Considerable tool support is required,</em> especially (a) a metrics tool or a configuration management system; (b) a code browsers that is able to trace back polymorphic method invocations.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="difficulties-11"><a class="anchor" href="#difficulties-11"></a>Difficulties</h5>
<div class="ulist">
<ul>
<li>
<p><em>Imprecise for many changes,</em> because when too many changes have been applied on the same piece of code, it becomes difficult to reconstruct the change process.</p>
</li>
<li>
<p><em>Sensitive to renaming,</em> if one identifies classes and methods via their name<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>. Then rename operations will show up as removals and additions which makes interpreting the data more difficult.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rationale-8"><a class="anchor" href="#rationale-8"></a>Rationale</h4>
<div class="paragraph">
<p>Many object-oriented systems came into being via a combination of iterative and incremental development (see [Boo94] [GR95] [JGJ97] [Ree96]). That is, the original development team recognized their lack of problem domain expertise and therefore invested in a learning process where each learning phase resulted in a new system release. It is worthwhile to reconstruct that learning process because it will help you to understand the rationale embodied in the system design.</p>
</div>
<div class="paragraph">
<p>One way to reconstruct the learning process is to recover its primitive steps. In object-oriented parlance, these steps are called refactorings and consequently this pattern tells you how to recover refactorings like they have been applied in the past. The technique itself compares two subsequent releases of the source code identifying entities that decrease in size, because that’s the typical symptom of functionality that has been moved elsewhere.</p>
</div>
</div>
<div class="sect3">
<h4 id="known-uses-11"><a class="anchor" href="#known-uses-11"></a>Known Uses</h4>
<div class="paragraph">
<p>We ran an experiment on three medium-sized systems implemented in Smalltalk. As reported in [DDN00], these case studies suggest that some simple heuristics can support the reverse engineering process by focusing attention on parts of the system where functionality has been removed. This way, we could for instance detect where a class had been split or where methods have been moved to a sibling class. Of course these refactorings must be examined in further detail to guess the intent behind the refactoring. This is never easy but in our experience has proven worthwhile. In one particular case for instance, we discovered several classes where methods had been moved to sibling classes. Closer examination revealed that the reengineer was moving these methods to break circular dependencies and was in fact introducing a layer.</p>
</div>
<div class="paragraph">
<p>Other researchers also report on examining changes to support the reverse engineering process. For instance, Ball <em>et al.</em> annotate code views with colors showing code age [BE96]. On the other hand, Jazayeri <em>et al.</em> use a three-dimensional visual representation for examining a system’s software release history [JGR99]. The same people have also investigated which change requests affect which software modules to detect logical dependencies between software modules [GHJ98].</p>
</div>
</div>
<div class="sect3">
<h4 id="what-next-14"><a class="anchor" href="#what-next-14"></a>What Next</h4>
<div class="paragraph">
<p>Now that you discovered some stable parts in the design, you will probably want to reuse them. In that case take some precautions: first document the interfaces of that part (see Look for the Contracts) and then write the corresponding test cases (see Test the Interface, Not the Implementation [p. 155]).</p>
</div>
<div class="paragraph">
<p>On the other hand, the unstable parts of the design should probably be dismissed. Nevertheless, if the unstable part seems crucial for your reengineering project, then you must seek which change requests caused the instability. In that case, Chat with the Maintainers [p. 38] or even Interview During Demo [p. 59] and based on this knowledge decide how to restructure that part so that it is better suited for the kind of change requests that come in.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. Note that some configuration management systems keep track of renaming operations which will of course alleviate the problem.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-01-26 10:37:45 MEZ
</div>
</div>
</body>
</html>