<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>9. Redistribute Responsibilities</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#redistribute-responsibilities">9. Redistribute Responsibilities</a>
<ul class="sectlevel2">
<li><a href="#forces-6">Forces</a></li>
<li><a href="#overview-7">Overview</a></li>
<li><a href="#move-behavior-close-to-data">9.1 Move Behavior Close to Data</a></li>
<li><a href="#eliminate-navigation-code">9.2 Eliminate Navigation Code</a></li>
<li><a href="#split-up-god-class">9.3 Split Up God Class</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="redistribute-responsibilities"><a class="anchor" href="#redistribute-responsibilities"></a>9. Redistribute Responsibilities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You are responsible for reengineering the information system that manages all employee records for a large public administration. Due to recent political upheavals, you know that there will be many changes required in the system to cope with privatization, new laws, and new regulations, but you do not know exactly what they will be. The existing system consists of a nominally object-oriented reimplementation of an older procedural system. The code contains many pseudo-objects: data containers masquerading as objects, and big, procedural “god classes” that implement most of a the logic of individual subsystems. One class, called TaxRevision2000, has a single method consisting essentially of a case statement that is 3000 lines long.</p>
</div>
<div class="paragraph">
<p>As long as the system was relatively stable, this design posed no particular problems, but now you see that even relatively modest changes to system require months of planning, testing and debugging due to weak encapsulation of data. You are convinced that migrating to a more objectoriented design will make the system more robust and easier to adapt to future requirements. But how do you know where the problems lie? Which responsibilities should be redistributed? Which data containers should you redesign, which ones should you wrap, and which ones are better left alone?</p>
</div>
<div class="sect2">
<h3 id="forces-6"><a class="anchor" href="#forces-6"></a>Forces</h3>
<div class="ulist">
<ul>
<li>
<p>Data containers (objects that just provide access to data, but no own behavior) are a simple and convenient way to share information between many subsystems. Among others, data containers are the easiest way to provide access to database entities.</p>
</li>
<li>
<p>However, data containers expose the data representation, hence are difficult to change when many application components depend on them. _Consequently, a proliferation of data containers leads to fragile navigation code in the implementation of business logic.* It is hard to teach an old dog new tricks. Many designers received a training in functional decomposition and will use the same habits when doing an object design.</p>
</li>
<li>
<p>However, functional decomposition tends to generate god classes, <em>i.e.</em>, big classes that do all of the work and have a myriad of tiny provider classes around of it. God classes are hard to extend, modify or subclass because such changes affect large numbers of other methods or instance variables.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="overview-7"><a class="anchor" href="#overview-7"></a>Overview</h3>
<div class="paragraph">
<p>This cluster deals with problems of misplaced responsibilities. The two extreme cases are <em>data containers</em>, classes that are nothing but glorified data structures and have almost no identifiable responsibilities, and <em>god classes</em>, procedural monsters that assume too many responsibilities.</p>
</div>
<div class="paragraph">
<p>Although there are sometimes borderlines cases where data containers and god classes may be tolerated, particularly if they are buried in a stable part of the system which will not change, generally they are a sign of a fragile design.</p>
</div>
<div class="paragraph">
<p>Data containers lead to violations of the <em>Law of Demeter</em> (LOD) [LHR88]. In a nutshell, the Law of Demeter provides a number of design guidelines to reduce coupling between distantly-related classes. Although the Law of Demeter has various forms, depending on whether one focusses on objects or classes, and depending on which programming language is being used, the law essentially states that methods should only send messages to instance variables, method arguments, self, super, and the receiver class.</p>
</div>
<div class="paragraph">
<p>Violations of the Law of Demeter typically take the form of <em>navigation code</em> in which an <em>indirect client</em> accesses an <em>indirect provider</em> by accessing either an instance variable or an acquaintance of an <em>intermediate provider</em>. The indirect client and provider are thereby unnecessarily coupled, making future enhancements more difficult to realize (Figure 9.2). The intermediate provider may take the form of a data container or opens its encapsulation by providing accessor methods. Designs with many data containers present often suffer from complex navigation code in which indirect clients may have to navigate through a chain of intermediates to reach the indirect provider.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./media/image28.jpg" alt="image" width="432" height="107"></span></p>
</div>
<div class="paragraph">
<p>Figure 9.1: An indirect client violates the Law of Demeter by navigating through an intermediate provider to an indirect provider, unnecessarily coupling the two.</p>
</div>
<div class="paragraph">
<p>Whereas data containers have too few responsibilities, god classes assume too many. A god class can be a single class that implements an entire subsystem, consisting of thousands of lines of code and hundreds of methods and instance variables. Particularly vicious god classes consist of only static instance variables and methods, <em>i.e.</em>, all data and behavior have class scope, and the god class is never instantiated. Such god classes are purely procedural beasts, and are object-oriented in name only.</p>
</div>
<div class="paragraph">
<p>Occasionally some procedural classes known as <em>utility classes</em> are convenient. The best known examples are object-oriented interfaces to math libraries, or collections of algorithms. Real god classes, however, are not libraries, but complete applications or subsystems that controls the entire application execution.</p>
</div>
<div class="paragraph">
<p>God classes and data containers often occur together, with the god class assuming all the control of the application, and treating other classes as glorified data structures. Since they assume too many responsibilities, god classes are hard to understand and maintain. Incremental modification and extension of a god class through inheritance is next to impossible due to the complexity of its interface and the absence of clear subclassing contract.</p>
</div>
<div class="paragraph">
<p>This cluster provides a number of patterns to eliminate data containers and god classes by redistributing responsibilities and thereby improving encapsulation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Move Behavior Close to Data [p. 221] moves behavior defined in</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="./media/image29.jpg" alt="image" width="432" height="145"></span></p>
</div>
<div class="paragraph">
<p>Figure 9.2: Data containers are the clearest sign of misplaced responsibilities. These three patterns redistribute responsibilities by moving behavior close to data.</p>
</div>
<div class="paragraph">
<p>indirect clients to an intermediate data container to make it more “object-like”. This pattern not only decouples indirect clients from the contents of the data container, but also typically eliminates duplicated code occurring in multiple clients of the data container.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eliminate Navigation Code [p. 230] is technically very similar to Move Behavior Close to Data in terms of the reengineering steps, but is rather different in its intent. This pattern focusses on redistributing responsibilities down chains of data containers to eliminate navigation code.</p>
</li>
<li>
<p>Split Up God Class [p. 239] refactors a procedural god class into a number of simple, more cohesive classes by moving all data to external data containers, applying Move Behavior Close to Data to promote the data containers to objects, and finally removing or deprecating the facade that remains.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="move-behavior-close-to-data"><a class="anchor" href="#move-behavior-close-to-data"></a>9.1 Move Behavior Close to Data</h3>
<div class="paragraph">
<p><strong>Intent</strong> _Strengthen encapsulation by moving behavior from indirect clients to the class containing the data it operates on.</p>
</div>
<div class="sect3">
<h4 id="problem-33"><a class="anchor" href="#problem-33"></a>Problem</h4>
<div class="paragraph">
<p>How do you transform a class from being a mere data container into a real service provider?</p>
</div>
<div class="paragraph">
<p><em>This problem is difficult because:</em>
* Data containers offer only accessor methods or public instance variables, and not real behavior, forcing clients to define the behavior themselves instead of just using it. New clients typically have to reimplement this behavior.
* If the internal representation of a data container changes, many clients have to be updated.
* Data containers cannot be used polymorphically since they define no behavior and their interfaces consist mainly of accessor methods. As a consequence, clients will be responsible for deciding which behavior is called for in any given context.</p>
</div>
<div class="paragraph">
<p><em>Yet, solving this problem is feasible because:</em>
* You know what operations clients perform with the data.</p>
</div>
</div>
<div class="sect3">
<h4 id="solution-32"><a class="anchor" href="#solution-32"></a>Solution</h4>
<div class="paragraph">
<p>Move behavior defined by indirect clients to the container of the data on which it operates.</p>
</div>
<div class="paragraph">
<p><strong>Detection</strong> Look for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Data containers, <em>i.e.</em>, classes defining mostly public accessor methods and few behavior methods (<em>i.e.</em>, the number of methods is approximately 2 times larger than the number of attributes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="./media/image30.jpg" alt="image" width="432" height="250"></span></p>
</div>
<div class="paragraph">
<p>Figure 9.3: Classes that were mere data containers are transformed into real service providers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Duplicated client code that manipulates data of separate provider classes. If multiple clients implement <em>different</em> behavior, consider instead applying Transform Client Type Checks [p. 257].</p>
</li>
<li>
<p>Methods in client classes that invoke a sequence of accessor methods (see Eliminate Navigation Code).</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="steps-12"><a class="anchor" href="#steps-12"></a>Steps</h5>
<div class="paragraph">
<p>Move Behavior Close to Data makes use of the refactorings Extract Method [p. 291] and Move Method [p. 291], since the behavior in question will have to be extracted from a client method and then moved to a provider class.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Identify the client behavior that you want to move</em>, <em>i.e.</em>, the complete method or a part of a method that accesses provider data.</p>
<div class="ulist">
<ul>
<li>
<p>Look for the invocations of the accessor methods of the data container.</p>
</li>
<li>
<p>Look for duplicated code in multiple clients that access the same provider data.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Create the corresponding method in the provider class</em>, if it does not already exist. Be sure to check that moving the code will not introduce any naming conflicts. Tools like the Refactoring Browser [RBJ97] automate these steps:</p>
<div class="ulist">
<ul>
<li>
<p>If the extracted functionality is a complete method with arguments, check that the arguments do not conflict with attributes of the provider class. If so, rename the arguments.</p>
</li>
<li>
<p>If the extracted functionality uses temporary variables, check that the local variables do not conflict with attributes or variables in the target scope. If so, rename the temporary variables.</p>
</li>
<li>
<p>Check if the extracted functionality accesses local variables of the client classes (attributes, temporary variables,&#8230;&#8203;), if so, add arguments to the method to represent these client variables.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Give an intention-revealing name to the new method.</em> Among others, intention revealing names do not contain references to the class they belong to, because this makes the method less reusable. For instance, instead of defining a method addToSet() on a class Set, it is better to name it simply add(). Similarly, it is not such a good idea to define a method binarySearch() on a class Array, because the method name implies a sorted random access collection, while the name search() does not have such implications.</p>
</li>
<li>
<p>In the client <em>invoke the new provider method</em> with the correct parameters.</p>
</li>
<li>
<p><em>Clean up the client code.</em> In the case the moved functionality was a complete method of the client class:</p>
<div class="ulist">
<ul>
<li>
<p>check all the methods that invoke the old, moved method and ensure that they now call the new provider method instead, and</p>
</li>
<li>
<p>remove the old method from the client or deprecate it. (Deprecate Obsolete Interfaces [p. 193]).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>It may be the case that the calling methods defined on the same object have to be also moved to the provider. In such a case repeat the steps for the methods.
1.  <em>Repeat</em> for multiple clients. Note that duplicated code in multiple clients will be removed in step 2, since there is no need to move code that has already been transferred to the provider. In case many similar, but not identical methods are introduced to the provider, consider factoring out the duplicated fragments as protected helper methods.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tradeoffs-33"><a class="anchor" href="#tradeoffs-33"></a>Tradeoffs</h4>
<div class="sect4">
<h5 id="pros-32"><a class="anchor" href="#pros-32"></a>Pros</h5>
<div class="ulist">
<ul>
<li>
<p>Data containers are converted to service providers with clear responsibilities.</p>
</li>
<li>
<p>The service providers become more useful to other clients.</p>
</li>
<li>
<p>Clients are no longer responsible for implementing provider behavior.</p>
</li>
<li>
<p>Clients are less sensitive to internal changes of the provider.</p>
</li>
<li>
<p>Code duplication in the system decreases.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cons-27"><a class="anchor" href="#cons-27"></a>Cons</h5>
<div class="ulist">
<ul>
<li>
<p>If the moved behavior also accesses client data, turning these accesses into parameters will make the interface of the provider more complex and introduce explicit dependencies from the provider to the client.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="difficulties-29"><a class="anchor" href="#difficulties-29"></a>Difficulties</h5>
<div class="ulist">
<ul>
<li>
<p>It may not be clear whether client code really should be moved to the data provider. Some classes like Stream or Set are really designed as data providers. Consider moving the code to the provider if:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>–</strong> the functionality represents a <em>responsibility</em> of the provider. For example, a class Set should provide mathematical operations like union and intersection. On the other hand, a generic Set should not be responsible for operations on sets of Employees. <strong>–</strong> the functionality accesses the attributes of the provider, <strong>–</strong> the functionality is defined by multiple clients.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the provider is really designed as a data container, consider defining a new provider class that wraps an instance of the data provider and holds the associated behavior. For example, an EmployeeSet might wrap a Set instance and provide a more suitable interface.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="when-the-legacy-solution-is-the-solution"><a class="anchor" href="#when-the-legacy-solution-is-the-solution"></a>When the legacy solution is the solution</h5>
<div class="paragraph">
<p>Data containers may have been automatically generated from a database schema to provide an object interface to an existing database. It is almost always a bad idea to modify generated classes, since you will lose your changes if the code ever needs to be regenerated. In this case, you may decide to implement wrapper classes to hold the behavior that should be associated with the generated classes. Such a wrapper would function as an Adapter [p. 293] that converts the generated data container to a real service provider.</p>
</div>
<div class="paragraph">
<p>Sometimes you know that a class defined in a library is missing crucial functionality. For example, an operation convertToCapitals that is missing for class String. In such a case it is typically impossible to add code to the library, so you may have to define it in client class. In C++ for example, it may be the only way to avoid recompilation or to extend a class when the code is not available [ABW98] (p. 378). In Smalltalk you have the possibility to extend or modify the library, however you should pay particular attention to separate the additional code so you can easily merge it with future releases of the library, and quickly detect any conflicts.</p>
</div>
<div class="paragraph">
<p>The intent of the Visitor [p. 296] design pattern states: <em>“Represent an operation to be performed on the elements of an object structure in a class separate from the elements themselves. Visitor lets you define a new operation without changing the classes of the elements on which it operates”</em> [GHJV95]. The Visitor pattern is one of the few cases where you want to have classes access the data of a separate provider class. Visitor allows one to dynamically add new operations to a set of stable classes without having to change them.</p>
</div>
<div class="paragraph">
<p><em>Configuration classes</em> are classes that represent the configuration of a system (<em>e.g.</em>, global parameters, language dependent representation, policies in place). For example, in a graphic tool the default size of the boxes, edges, width of the lines can be stored in a such class and other classes refer to it when needed.</p>
</div>
<div class="paragraph">
<p><em>Mapping classes</em> are classes used to represent mappings between objects and their user interface or database representation. For example, a software metric tool should graphically represent the available metrics in a widget-list so that the user can select the metrics to be computed. In such a case the graphical representation of the different metrics will certainly differ from their internal representation. A mapping class keeps track of the association.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-14"><a class="anchor" href="#example-14"></a>Example</h4>
<div class="paragraph">
<p>One of the recurring complaints of the customers is that it takes too much time to change the reports generated by the information system. By talking to the maintainers you learn that they find generating the reports quite boring. “Its’s always the same code you have to write,” says Chris, one</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./media/image31.jpg" alt="image" width="432" height="133"></span></p>
</div>
<div class="paragraph">
<p>Figure 9.4: The Payroll and Telephone classes access the internal representation of the class Employee to print a representation.</p>
</div>
<div class="paragraph">
<p>of the maintainers. “You fetch a record out of the database, print its fields and then proceed to the next record.”</p>
</div>
<div class="paragraph">
<p>You strongly suspect a case of data-containers and a closer examination of the code confirms your suspicion. Almost all of the classes interfacing with the database contain accessor methods only, and the programs generating reports are forced to use these accessors. One striking example is the case of the Payroll application, which has lots in common with the TelephoneGuide application and you decide to try to move the common functionality to the Employee class.</p>
</div>
<div class="sect4">
<h5 id="before"><a class="anchor" href="#before"></a>Before</h5>
<div class="paragraph">
<p>As shown in Figure 9.4, both the Payroll and TelephoneGuide classes print labels, treating Employee instances as data containers. Thus, Payroll and TelephoneGuide are indirect clients of the attributes of Employee, and define printing code that should have been provided by the Employee class.</p>
</div>
<div class="paragraph">
<p>The following code show how this would look like in Java.</p>
</div>
<div class="paragraph">
<p>|
a|
public class Employee \{ public String[] telephoneNumbers = \{};</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>public String name() \{ return name;}</p>
</div>
<div class="paragraph">
<p>public String address() \{ return address;}</p>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>public class Payroll \{</p>
</div>
<div class="paragraph">
<p>a|
public static Employee currentEmployee;</p>
</div>
<div class="paragraph">
<p>public static void printEmployeeLabel () \{</p>
</div>
<div class="paragraph">
<p>System.out.println(currentEmployee.name()); System.out.println(currentEmployee.address());</p>
</div>
<div class="paragraph">
<p>for (int i=0; i &lt; currentEmployee.telephoneNumbers.length; i++) \{ System.out.print(currentEmployee.telephoneNumbers[i]); System.out.print(" ");}</p>
</div>
<div class="paragraph">
<p>System.out.println("");}</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>public class TelephoneGuide \{</p>
</div>
<div class="paragraph">
<p>public static void printEmployeeTelephones (Employee emp) \{</p>
</div>
<div class="paragraph">
<p>System.out.println(emp.name()); System.out.println(emp.address());</p>
</div>
<div class="paragraph">
<p>for (int i=0; i &lt; emp.telephoneNumbers.length&#8201;&#8212;&#8201;1; i++) \{</p>
</div>
<div class="paragraph">
<p>System.out.print(emp.telephoneNumbers[i]); System.out.print(" ---- ");}</p>
</div>
<div class="paragraph">
<p>System.out.print(emp.telephoneNumbers[ emp.telephoneNumbers.length&#8201;&#8212;&#8201;1]); System.out.println("");}</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>}</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>|</p>
</div>
<div class="paragraph">
<p>Note that although both print methods implement essentially the same functionality, there are some slight differences. Among others, TelephoneGuide.printEmployeeTelephones uses a different separator while printing out the telephone numbers.</p>
</div>
</div>
<div class="sect4">
<h5 id="steps-13"><a class="anchor" href="#steps-13"></a>Steps</h5>
<div class="paragraph">
<p>The different separators can easily be dealt with by defining a special parameter representing the separator to be used. Thus TelephoneGuide.printEmployeeTelephones gets rewritten as follows.</p>
</div>
<div class="paragraph">
<p>|
a|
public static void printEmployeeTelephones (Employee emp, String separator) \{</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>for (int i=0; &#8230;&#8203;</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>System.out.print(separator);}</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;} &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>|</p>
</div>
<div class="paragraph">
<p>Next, move the printEmployeeTelephones method from TelephoneGuide to Employee. Thus, copy the code and replace all references to the emp parameter with a direct reference to the attributes and methods. Also, ensure that the new method has an intention revealing name, thus omit the Employee part from the method name, resulting in a method printLabel.</p>
</div>
<div class="paragraph">
<p>|
a|
public class Employee \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>public void printLabel (String separator) \{</p>
</div>
<div class="paragraph">
<p>System.out.println(name);</p>
</div>
<div class="paragraph">
<p>System.out.println(address);</p>
</div>
<div class="paragraph">
<p>for (int i=0; i &lt; telephoneNumbers.length&#8201;&#8212;&#8201;1; i++) \{</p>
</div>
<div class="paragraph">
<p>System.out.print(telephoneNumbers[i]);</p>
</div>
<div class="paragraph">
<p>System.out.print(separator);</p>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>System.out.print(telephoneNumbers[telephoneNumbers.length&#8201;&#8212;&#8201;1]); System.out.println("");</p>
</div>
<div class="paragraph">
<p>}
|</p>
</div>
<div class="paragraph">
<p>Then replace the method bodies of Payroll.printEmployeeLabel and TelephoneGuide.printEmployeeTelephones with a simple invocation of the Employee.printLabel method.</p>
</div>
<div class="paragraph">
<p>|
a|
public class Payroll \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>public static void printEmployeeLabel () \{ currentEmployee.printLabel(" ");</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;}</p>
</div>
<div class="paragraph">
<p>public class TelephoneGuide \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>public static void printEmployeeTelephones (Employee emp) \{ emp.printLabel(" ---- ");}</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;}
|</p>
</div>
<div class="paragraph">
<p>Finally, verify which other methods refer to the name(), address() and telephoneNumbers. If no such methods exist, consider to declare those methods and attributes as private.</p>
</div>
</div>
<div class="sect4">
<h5 id="after"><a class="anchor" href="#after"></a>After</h5>
<div class="paragraph">
<p>After applying Move Behavior Close to Data the class Employee now provides a printLabel method which takes one argument to represent the different separators (see Figure 9.5). This is a better situation because now</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./media/image32.jpg" alt="image" width="432" height="150"></span></p>
</div>
<div class="paragraph">
<p>Figure 9.5: The Payroll class uses the public interface of the class Employee to print a representation of Employee; data accessors became private.</p>
</div>
<div class="paragraph">
<p>clients do not rely on the internal representation of Employee. Moreover, by moving the behavior near the data it operates, the class represents a conceptual entity with an emphasis on the services it provides instead of structure it implements.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rationale-27"><a class="anchor" href="#rationale-27"></a>Rationale</h4>
<div class="paragraph">
<p>_Keep related data and behavior in one place.
— Arthur Riel, Heuristic 2.9 [Rie96]</p>
</div>
<div class="paragraph">
<p>Data containers impede evolution because they expose structure and force clients to define their behavior rather than sharing it. By promoting data containers to service providers, you reduce coupling between classes and improve cohesion of data and behavior.</p>
</div>
</div>
<div class="sect3">
<h4 id="related-patterns-21"><a class="anchor" href="#related-patterns-21"></a>Related Patterns</h4>
<div class="paragraph">
<p>Encapsulate Field [p. 291] offers heuristics that help determine where methods should be defined during a design phase. The text offers rationale for applying Move Behavior Close to Data.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="eliminate-navigation-code"><a class="anchor" href="#eliminate-navigation-code"></a>9.2 Eliminate Navigation Code</h3>
<div class="paragraph">
<p><em>Also Known As:</em> Law of Demeter [LHR88]</p>
</div>
<div class="paragraph">
<p><strong>Intent</strong> _Reduce the impact of changes by shifting responsibility down a chain of connected classes.</p>
</div>
<div class="sect3">
<h4 id="problem-34"><a class="anchor" href="#problem-34"></a>Problem</h4>
<div class="paragraph">
<p>How do you reduce coupling due to classes that navigate through the object graph?</p>
</div>
<div class="paragraph">
<p><em>This problem is difficult because:</em>
* Changes in the interfaces of a class will affect not only direct clients, but also all the indirect clients that navigate to reach it.</p>
</div>
<div class="paragraph">
<p><em>Yet, solving this problem is feasible because:</em>
* Navigation code is typically a sign of misplaced responsibilities and violation of encapsulation.</p>
</div>
</div>
<div class="sect3">
<h4 id="solution-33"><a class="anchor" href="#solution-33"></a>Solution</h4>
<div class="paragraph">
<p>Iteratively move behavior defined by an indirect client to the container of the data on which it operates.</p>
</div>
<div class="paragraph">
<p>Note that actual reengineering steps are basically the same as those of Move Behavior Close to Data, but the manifestation of the problem is rather different, so different detection steps apply.</p>
</div>
<div class="sect4">
<h5 id="detection"><a class="anchor" href="#detection"></a>Detection</h5>
<div class="paragraph">
<p>Look for <em>indirect providers</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each time a class changes, <em>e.g.</em>, by modifying its internal representation or collaborators, not only its direct but also <em>indirect</em> client classes have to be changed.</p>
</li>
<li>
<p>Look for classes that contain a lot public attributes, accessor methods or methods returning as value attributes of the class.</p>
</li>
<li>
<p>Big aggregation hierarchies containing mostly data classes often play the role of indirect provider.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Look for <em>indirect clients</em> that contain a lot of <em>navigation code</em>. Navigation code is of two kinds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <em>sequence of attribute accesses</em>, <em>e.g.</em>,a.b.c.d where b is an attribute of a, c is an attribute of b and d an attribute of c. The result of such a sequence can be assigned to variable or a method of the last object can be invoked, <em>e.g.</em>,a.b.c.d.op(). Such a sequence navigation does not occur in Smalltalk where all the attributes are protected.</p>
</li>
<li>
<p>a <em>sequence of accessor method calls</em>. In Java and C++ such a sequence has the form object.m1().m2().m3() where object is an expression returning an object, m1 is a method of object, m2 a method of the object returned by the invocation of m1, m3 a method of the object returned by the invocation of m2 and so on. In Smalltalk navigation code has the following form receiver m1 m2 &#8230;&#8203; mn The same navigation code sequence is repeated in different methods on the same or different clients.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Navigation code can be detected by simple pattern matching. However, to really detect a method call navigation sequence leading to coupled classes, you should filter out sequences of calls converting one object to another one. For example, the following two Java expressions are not problematic because they deal with object conversion.</p>
</div>
<div class="paragraph">
<p>leftSide().toString()</p>
</div>
<div class="paragraph">
<p>i.getValue().isShort()</p>
</div>
<div class="paragraph">
<p>To deal with this case you can:
* look for more than two calls, or
* eliminate from consideration known object conversion calls, including standard method invocations for converting to and from primitive types.</p>
</div>
<div class="paragraph">
<p>The use of additional variables, can sometimes disguise navigation code, so reading the code is often necessary. For instance, the following Java code does not contain a chain of invocations.</p>
</div>
<div class="paragraph">
<p>|
a|
Token token; token = parseTree.token(); if (token.identifier() != null) \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>|</p>
</div>
<div class="paragraph">
<p>However, it is equivalent to the following code, which does contain a chain of invocations</p>
</div>
<div class="paragraph">
<p>|
a|
if (parseTree.token().identifier() != null) \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>|</p>
</div>
<div class="paragraph">
<p><em>Smalltalk.</em> Simply searching for sequences of calls in Smalltalk code can create a lot of noise because Smalltalk does not have predefined control structures but uses messages even for implementing control structures. The above example with the disguised navigation code would read as follows in Smalltalk. (Note the messages isNil and ifFalse:[&#8230;&#8203;])</p>
</div>
<div class="paragraph">
<p>|
a|
| token | token := parseTree token.</p>
</div>
<div class="paragraph">
<p>token identifier isNil ifFalse:[&#8230;&#8203;]</p>
</div>
<div class="paragraph">
<p>|</p>
</div>
<div class="paragraph">
<p>The equivalent version with navigation code becomes.</p>
</div>
<div class="paragraph">
<p>parseTree token identifier isNil ifFalse: [&#8230;&#8203;]</p>
</div>
<div class="paragraph">
<p>The following code segments contain a sequence of invocations but do not pose any problems because the first deals with boolean testing and the second with conversion (abuse of conversion, in fact).</p>
</div>
<div class="paragraph">
<p>(a isNode) &amp; (a isAbstract) ifTrue: [&#8230;&#8203;] aCol asSet asSortedCollection asOrderedCollection</p>
</div>
<div class="paragraph">
<p><em>Java.</em> For Java or C++, primitives data types and control structures are not implemented using objects, so simple pattern matching produces less noise. For example, a simple Unix command like:</p>
</div>
<div class="paragraph">
<p>egrep '.<strong>\(\).</strong>\(\).<strong>\(\).' *.java egrep '.</strong>\..<strong>\..</strong>\..' *.java</p>
</div>
<div class="paragraph">
<p>identifies lines of code like the following ones, which are examples of navigation code coupling between classes, and filters out the conversions mentioned above.</p>
</div>
<div class="paragraph">
<p>a.getAbstraction().getIdentifier().traverse(this)</p>
</div>
<div class="paragraph">
<p>a.abstraction.identifier.traverse(this)</p>
</div>
<div class="paragraph">
<p>More sophisticated matching expressions can reduce the noise produced by the parentheses of casts or other combinations.</p>
</div>
<div class="paragraph">
<p><em>AST Matching.</em> If you have a way to express tree matching, you can detect navigation code. For example, the Rewrite Rule Editor that comes with the Refactoring Browser [RBJ97] can detect navigation code using the pattern</p>
</div>
<div class="paragraph">
<p>_<span class="image"><img src="./media/image33.png" alt="image" width="342" height="273"></span>
Figure 9.6: Chains of data containers can be converted into service providers, thereby eliminating navigation code and reducing coupling between classes.</p>
</div>
<div class="paragraph">
<p>’@object ’mess1 ’mess2 ’mess3. To narrow the analysis of the results you should only consider messages that belong to the domain objects and eliminate all the method selectors of libraries objects like (isNil, not, class,</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;).</p>
</div>
</div>
<div class="sect4">
<h5 id="steps-14"><a class="anchor" href="#steps-14"></a>Steps</h5>
<div class="paragraph">
<p>The recipe for eliminating navigation code is to recursively Move Behavior Close to Data. Figure 9.6 illustrates the transformation.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Identify</em> the navigation code to move.</p>
</li>
<li>
<p><em>Apply</em> Move Behavior Close to Data to remove one level of navigation. (At this point your regression tests should run.)</p>
</li>
<li>
<p><em>Repeat</em>, if necessary.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Caution.</em> It is important to note that the refactoring process relies on pushing code <em>from the clients to the providers</em>. In the example, from Car to Engine and from Engine to Carburetor. A common mistake is to try to eliminate navigation code by defining accessors at the client class level that access the attributes of the provider attribute values, <em>e.g.</em>, defining an accessor getCarburetor in the class Car. Instead of reducing coupling between the classes, it just increases the number of public accessors and makes the system more complex.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tradeoffs-34"><a class="anchor" href="#tradeoffs-34"></a>Tradeoffs</h4>
<div class="sect4">
<h5 id="pros-33"><a class="anchor" href="#pros-33"></a>Pros</h5>
<div class="ulist">
<ul>
<li>
<p>Chains of dependencies between classes are eliminated, so changes in classes at the lowest level will impact fewer clients.</p>
</li>
<li>
<p>Functionality that was implicit in the system is now named and explicitly available to new clients.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cons-28"><a class="anchor" href="#cons-28"></a>Cons</h5>
<div class="ulist">
<ul>
<li>
<p>The systematic application of Eliminate Navigation Code may lead to large interfaces. In particular, if a class defines many instance variables that are collections, then Eliminate Navigation Code would force you to define a large number of additional methods to shield the underlying collections.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="difficulties-30"><a class="anchor" href="#difficulties-30"></a>Difficulties</h5>
<div class="ulist">
<ul>
<li>
<p>Deciding when to apply Eliminate Navigation Code can be difficult. Defining methods that merely delegate requests to class collaborators may not always be the solution. It may happen that giving away internal information can reduce the interface of a class. For example, if a class implements some well-defined behaviors but also serves as a Facade [p. 293] to other collaborators, it may be simpler to give access to the collaborator directly to reduce the interface of the class.
===== When the legacy solution is the solution</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Navigation code may be the best solution when objects are graphically presented or mapped to a database. In such cases the goal is to really expose and mimic the structural relationships between classes. Eliminating navigation code will be a futile exercise.</p>
</div>
<div class="paragraph">
<p>Figure 9.7: How to remove the unnecessary dependencies between the Reports class and the File and Employee Classes.</p>
</div>
<div class="paragraph">
<p>It is sometimes necessary for a client to talk with its indirect providers. This is true when direct providers play the role of an object server that returns certain objects given certain properties (OOID, keys&#8230;&#8203;). In this situation the client calls the object <em>server</em> (a direct provider) that returns objects (indirect providers) to which the client sends messages.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-15"><a class="anchor" href="#example-15"></a>Example</h4>
<div class="paragraph">
<p>After having modified the Employee, Payroll and TelephoneGuide classes, you noticed that it took 1/2 an hour to rebuild the whole project. Next time you see Chris (one of the maintainers) you ask him why this build took so long. “You probably changed the Employee class” he answers, “we don’t dare to touch that class anymore since so many classes depend on it”.</p>
</div>
<div class="paragraph">
<p>You decide to examine this Employee class in further detail and find many unnecessary dependencies. For instance (as shown in Figure 9.7) there is a class Reports, implementing one method countHandledFiles, which counts for each Department the number of files that are handled by all of its employees. Unfortunately, there is no direct relationship between Department and File and consequently the ReportHandledFiles must navigate over a department’s employees to enumerate all the files and access the handled() status.</p>
</div>
<div class="paragraph">
<p>The Java code below shows the situation before and after applying Eliminate Navigation Code. The bold textual elements highlight problems and the solutions in the before and after situation.</p>
</div>
<div class="sect4">
<h5 id="before-1"><a class="anchor" href="#before-1"></a>Before</h5>
<div class="paragraph">
<p>|
a|
public class Reports \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>public static void countHandledFiles(Department department) \{ int nrHandled = 0, nrUnhandled = 0;</p>
</div>
<div class="paragraph">
<p>for (int i=0; i &lt; department.employees.length; i) \{ for (int j=0; j &lt; department.employees[i].files.length; j) \{ if (department.employees[i].files[j].handled()) \{ nrHandled++;}</p>
</div>
<div class="paragraph">
<p>else \{ nrUnhandled++;}}}</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;}</p>
</div>
<div class="paragraph">
<p>|</p>
</div>
<div class="paragraph">
<p>The method countHandledFiles counts the number of handled files, by asking the current department its employees and for each of these files. The classes Department and Employee have to declare those attributes public. With this implementation, two problems occur:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Reports class must know how to enumerate the associations between Department, Employee and File, and this information must be accessible in the public interface of each of the classes. If one of these public interfaces change, then this change will affect all associated classes.</p>
</li>
<li>
<p>The method countHandledFiles is implemented by directly accessing the variables employees and files. This unnecessarily couples the class Reports and the classes Department and Employee. If the class Department or Employee change the data-structure used to gold the associated objects, then all the methods in class Reports will have to be adapted.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="steps-15"><a class="anchor" href="#steps-15"></a>Steps</h5>
<div class="paragraph">
<p>The solution is to extract the nested for loops as separate methods and move them on the appropriate classes. This is actually a two step process.</p>
</div>
<div class="paragraph">
<p>First extract the outer for loop from Reports.countHandledFiles as a separate method (name it countHandledFiles as well) and move it to the class Department.</p>
</div>
<div class="paragraph">
<p>|
a|
public class Department \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>public void countHandledFiles</p>
</div>
<div class="paragraph">
<p>(Counter nrHandled, Counter nrUnhandled) \{ for (int i=0; i &lt; this.employees.length; i) \{ for (int j=0; j &lt; this.employees[i].files.length; j) \{ if (this.employees[i].files[j].handled()) \{ nrHandled.increment();}</p>
</div>
<div class="paragraph">
<p>else \{ nrUnhandled.increment();}}}}
&#8230;&#8203;}</p>
</div>
<div class="paragraph">
<p>public class Reports \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>_private static void countHandledFiles(Department department) \{</p>
</div>
<div class="paragraph">
<p>Counter nrHandled = new Counter (0), nrUnhandled = new Counter</p>
</div>
<div class="paragraph">
<p>(0);</p>
</div>
<div class="paragraph">
<p>department.countHandledFiles(nrHandled, nrUnhandled);
&#8230;&#8203;}</p>
</div>
<div class="paragraph">
<p>|</p>
</div>
<div class="paragraph">
<p>Next, extract the inner for loop from Department.countHandledFiles (also named countHandledFiles) and move it to the class Employee.</p>
</div>
<div class="paragraph">
<p>|
a|
public class Employee \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>public void countHandledFiles</p>
</div>
<div class="paragraph">
<p>(Counter nrHandled, Counter nrUnhandled) \{ for (int j=0; j &lt; this.files.length; j++) \{ if (this.files[j].handled()) \{ nrHandled.increment();}</p>
</div>
<div class="paragraph">
<p>else \{ nrUnhandled.increment();}}}</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;}</p>
</div>
<div class="paragraph">
<p>public class Department \{</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>public void countHandledFiles</p>
</div>
<div class="paragraph">
<p>(Counter nrHandled, Counter nrUnhandled) \{ for (int i=0; i &lt; this.employees.length; i++) \{
a|
this.employees[i].countHandledFiles(nrHandled, nrUnhandled);}}</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;}</p>
</div>
<div class="paragraph">
<p>|</p>
</div>
<div class="paragraph">
<p>If all direct accesses to the employees and files variables are removed, these attributes can be declared private.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rationale-28"><a class="anchor" href="#rationale-28"></a>Rationale</h4>
<div class="paragraph">
<p>A method “M” of an object “O” should invoke only the methods of the following kinds of objects.1.  _itself2.  _its parameters3.  _any object it creates/instantiates4.  _its direct component objects
— Law of Demeter</p>
</div>
<div class="paragraph">
<p>Navigation code is a well-known symptom of misplaced behavior [LK94] [Sha97] [Rie96] that violates the Law of Demeter [LHR88]. It leads to unnecessary dependencies between classes and as a consequence changing the representation of a class requires <em>all</em> clients to be adapted.</p>
</div>
</div>
<div class="sect3">
<h4 id="related-patterns-22"><a class="anchor" href="#related-patterns-22"></a>Related Patterns</h4>
<div class="paragraph">
<p>Eliminate Navigation Code and Compare Code Mechanically [p. 204] reinforce each other: Navigation code that is spread across different clients spreads duplicated code over the system. Compare Code Mechanically helps to detect this phenomenon. Eliminate Navigation Code brings the duplicated code together, where it is easier to refactor and eliminate.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="split-up-god-class"><a class="anchor" href="#split-up-god-class"></a>9.3 Split Up God Class</h3>
<div class="paragraph">
<p><em>Also Known As:</em> The Blob [BMMM98], God Class [Rie96]</p>
</div>
<div class="paragraph">
<p><strong>Intent</strong> _Split up a class with too many responsibilities into a number of smaller, cohesive classes.</p>
</div>
<div class="sect3">
<h4 id="problem-35"><a class="anchor" href="#problem-35"></a>Problem</h4>
<div class="paragraph">
<p>How do you maintain a class that assumes too many responsibilities?</p>
</div>
<div class="paragraph">
<p><em>This problem is difficult because:</em>
* By assuming too many responsibilities, a god class monopolizes control of an application. Evolution of the application is difficult because nearly every change touches this class, and affects multiple responsibilities.
* It is difficult to understand the different abstractions that are intermixed in a god class. Most of the data of the multiple abstractions are accessed from different places.
* Identifying where to change a feature without impacting the other functionality or other objects in the system is difficult. Moreover, changes in other objects are likely to impact the god class, thus hampering the evolution of the system.
* It is nearly impossible to change a part of the behavior of a god class in a black-box way.</p>
</div>
<div class="paragraph">
<p><em>Yet, solving this problem is feasible because:</em>
* You don’t have to fix the problem in one shot.
* You can use Semantic Wrapper to wrap it and present interfaces.</p>
</div>
</div>
<div class="sect3">
<h4 id="solution-34"><a class="anchor" href="#solution-34"></a>Solution</h4>
<div class="paragraph">
<p>Incrementally redistribute the responsibilities of the god class either to its collaborating classes or to new classes that are pulled out the god class. When there is nothing left of the god class but a facade, remove or deprecate the facade.</p>
</div>
<div class="sect4">
<h5 id="detection-1"><a class="anchor" href="#detection-1"></a>Detection</h5>
<div class="paragraph">
<p>A god class may be recognized in various ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a single huge class treats many other classes as data structures.</p>
</li>
<li>
<p>a “root” class or other huge class has a name containing words like “System”, “Subsystem”, “Manager”, “Driver”, or “Controller”.</p>
</li>
<li>
<p>changes to the system always result in changes to the same class.</p>
</li>
<li>
<p>changes to the class are extremely difficult because you cannot identify which parts of the class they affect.</p>
</li>
<li>
<p>reusing the class is nearly impossible because it covers too many design concerns.</p>
</li>
<li>
<p>the class is a domain class holding the majority of attributes and methods of a system or subsystem. (Note that the threshold is not absolute because some UI frameworks produce big classes with lots of methods, and some database interface classes may need a lot of attributes).</p>
</li>
<li>
<p>the class has an unrelated set of methods working on separated instance variables. The cohesiveness of the class is usually low.</p>
</li>
<li>
<p>the class requires long compile times, even for small modifications.</p>
</li>
<li>
<p>the class is difficult to test due to the many responsibilities it assumes.</p>
</li>
<li>
<p>the class uses a lot of memory.</p>
</li>
<li>
<p>people tell you: “This is the heart of the system”.</p>
</li>
<li>
<p>when you ask for the responsibility of a god class you get various, long and unclear answers.</p>
</li>
<li>
<p>god classes are the nightmare of maintainers, so ask what classes are huge and difficult to maintain. Ask what is the class they would not like to work on. (Variant: Ask people to choose which class they want to work on. The one that everybody avoids may be a god class.)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="steps-16"><a class="anchor" href="#steps-16"></a>Steps</h5>
<div class="paragraph">
<p>The solution relies on incrementally moving behavior away from the god class. During this process, data containers will become more object-like by acquiring the functionality that the god class was performing on their data. Some new classes will also be extracted from the god class.</p>
</div>
<div class="paragraph">
<p>_<span class="image"><img src="./media/image34.png" alt="image" width="340" height="347"></span>
Figure 9.8: A god class is refactored in two stages, first by redistributing responsibilities to data containers, or by spawning off new classes, until there is nothing left but a facade, and second by removing the facade.</p>
</div>
<div class="paragraph">
<p>The following steps describe how this process ideally works. Note, however, that god classes can vary greatly in terms of their internal structure, so different techniques may be used to implement the transformation steps. Furthermore, it should be clear that a god class cannot be cured in one shot, so a safe way to proceed is to first transform a god class into a lightweight god class, then into a Facade [p. 293] that delegates behavior to its acquaintances. Finally, clients are redirected to the refactored data containers and the other new objects, and the Facade can be removed. The process is illustrated in figure 39.</p>
</div>
<div class="paragraph">
<p>The following steps are applied iteratively. Be sure to apply Regression Test After Every Change [p. 182]:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify cohesive subsets of instance variables of the god class, and convert them to external data containers. Change the initialization methods of the god class to refer to instances of the new data containers.</p>
</li>
<li>
<p>Identify all classes used as data containers by the god class (including those created in step 1) and apply Move Behavior Close to Data to promote the data containers into service providers. The original methods of the god class will simply delegate behavior to the moved methods.</p>
</li>
<li>
<p>After iteratively applying steps 1 and 2, there will be nothing left of the god class except a facade with a big initialization method. Shift the responsibility for initialization to a separate class, so only a pure facade is left. Iteratively redirect clients to the objects for which the former god class is now a facade, and either deprecate the facade (see Deprecate Obsolete Interfaces [p. 193]), or simply remove it.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tradeoffs-35"><a class="anchor" href="#tradeoffs-35"></a>Tradeoffs</h4>
<div class="sect4">
<h5 id="pros-34"><a class="anchor" href="#pros-34"></a>Pros</h5>
<div class="ulist">
<ul>
<li>
<p>Application control is no longer centralized in a single monolithic entity but distributed amongst entities that each assume a welldefined set of responsibilities. The design evolves from a procedural design towards an object-oriented design based on autonomous interacting objects.</p>
</li>
<li>
<p>Parts of the original god class are easier to understand and to maintain.</p>
</li>
<li>
<p>Parts of the original god class are more stable because they deal with less issues.</p>
</li>
<li>
<p>Overall compilation time may be reduced due to the simplification of system dependencies.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cons-29"><a class="anchor" href="#cons-29"></a>Cons</h5>
<div class="ulist">
<ul>
<li>
<p>Splitting up a god class is a long, slow and tedious process.</p>
</li>
<li>
<p>Maintainers will no longer be able to go to a single god class to locate behavior to fix.</p>
</li>
<li>
<p>The number of classes will increase.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="difficulties-31"><a class="anchor" href="#difficulties-31"></a>Difficulties</h5>
<div class="ulist">
<ul>
<li>
<p>God class methods may themselves be large, procedural abstractions with too many responsibilities. Such methods may need to be decomposed before cohesive sets of instance variables and methods can be teased out as classes.
===== When the legacy solution is the solution</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What is riskier? To Split Up God Class or to leave it alone? A real god class is a large, unwieldy beast. Splitting it up into more robust abstractions may introduce considerable cost.</p>
</div>
<div class="paragraph">
<p>The key issue is whether the god class needs to be <em>maintained</em>. If the god class consists of stable, legacy code that rarely needs to be extended or modified, then refactoring it is a questionable investment of effort.</p>
</div>
<div class="paragraph">
<p>Suppose, on the other hand, that it is the <em>clients</em> of the god class that are unstable, and need to be frequently adapted to changing requirements. Then the clients should be shielded from the god class since it is not presenting a clean interface. Consider instead applying Present the Right Interface [p. 187], which will introduce a layer of clean, object-oriented abstractions between the clients and the god class, and may make it easier to evolve the clients.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rationale-29"><a class="anchor" href="#rationale-29"></a>Rationale</h4>
<div class="paragraph">
<p>_Do not create god classes/objects in your system.
— Arthur Riel, Heuristic 3.2 [Rie96]</p>
</div>
<div class="paragraph">
<p>God classes impede evolution because they achieve only a low level of procedural abstraction, so changes may affect many parts of the god class, its data containers and its clients. By splitting a god class up into objectoriented abstractions, changes will tend to be more localized, therefore easier to implement.</p>
</div>
</div>
<div class="sect3">
<h4 id="related-patterns-23"><a class="anchor" href="#related-patterns-23"></a>Related Patterns</h4>
<div class="paragraph">
<p>Foote and Yoder in “Big Ball of Mud” [FY00] note that god classes (and worse) arise naturally in software development.</p>
</div>
<div class="paragraph">
<p>“People build BIG BALLS OF MUD because they work. In many domains, they are the only things that have been shown to work. Indeed, they work where loftier approaches have yet to demonstrate that they can compete.
_It is not our purpose to condemn BIG BALLS OF MUD. Casual architecture is natural during the early stages of a system’s evolution. The reader must surely suspect, however, that our hope is that we can aspire to do better. By recognizing the forces and pressures that lead to architectural malaise, and how and when they might be confronted, we hope to set the stage for the emergence of truly durable artifacts that can put architects in dominant positions for years to come. The key is to ensure that the system, its programmers, and, indeed the entire organization, learn about the domain, and the architectural opportunities looming within it, as the system grows and matures.”— Foote &amp; Yoder [FY00]</p>
</div>
<div class="paragraph">
<p>Present the Right Interface [p. 187] is a competing pattern that should be applied when the god class itself rarely needs to be modified or extended.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-01-26 06:10:29 MEZ
</div>
</div>
</body>
</html>